# Test Exploit Database Expansion
# Verifica che il database CVEâ†’MSF sia stato espanso da 7 a 20 exploit

Write-Host @"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                  â•‘
â•‘   ğŸ§ª NEXTMAP - EXPLOIT DATABASE EXPANSION TEST                  â•‘
â•‘                                                                  â•‘
â•‘   Verifying 20 CVE â†’ Metasploit exploit mappings                â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"@ -ForegroundColor Cyan

Write-Host "`nğŸ“Š DATABASE VERIFICATION" -ForegroundColor Yellow
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray

# Expected CVEs in database
$expectedCVEs = @(
    # Original 7 exploits
    "CVE-2023-44487",  # HTTP/2 Rapid Reset
    "CVE-2023-20198",  # Cisco IOS XE
    "CVE-2023-22515",  # Atlassian Confluence
    "CVE-2023-34362",  # MOVEit Transfer
    "CVE-2017-0144",   # EternalBlue
    "CVE-2019-0708",   # BlueKeep
    "CVE-2021-44228",  # Log4Shell
    
    # New 13 exploits (v0.3.3+)
    "CVE-2024-3400",   # Palo Alto PAN-OS
    "CVE-2023-46604",  # Apache ActiveMQ
    "CVE-2023-4966",   # Citrix Bleed
    "CVE-2023-27350",  # PaperCut NG/MF
    "CVE-2022-41040",  # ProxyNotShell (Exchange)
    "CVE-2022-26134",  # Confluence OGNL
    "CVE-2022-22965",  # Spring4Shell
    "CVE-2021-34473",  # ProxyShell (Exchange)
    "CVE-2021-26855",  # ProxyLogon (Exchange)
    "CVE-2020-1472",   # Zerologon
    "CVE-2019-19781",  # Citrix ADC/Gateway
    "CVE-2018-13379",  # Fortinet FortiOS
    "CVE-2018-7600",   # Drupalgeddon2
    "CVE-2017-5638",   # Apache Struts2
    "CVE-2017-0199",   # Microsoft Office/WordPad
    "CVE-2014-6271",   # Shellshock
    "CVE-2012-1823",   # PHP CGI
    "CVE-2008-4250"    # MS08-067
)

Write-Host "Expected CVE Count: $($expectedCVEs.Count)" -ForegroundColor Cyan
Write-Host ""

# Check if binary exists
if (-not (Test-Path ".\target\release\nextmap.exe")) {
    Write-Host "âŒ Binary not found! Run: cargo build --release" -ForegroundColor Red
    exit 1
}

# Test: Run with dry-run to see database load
Write-Host "ğŸ” Testing database load..." -ForegroundColor Yellow

$output = & .\target\release\nextmap.exe -t 127.0.0.1 -p 80 -s --cve-scan --msf-exploit --msf-dry-run --msf-lhost 127.0.0.1 2>&1 | Out-String

# Extract loaded CVE count from output
if ($output -match "Loaded (\d+) CVE â†’ MSF exploit mappings") {
    $loadedCount = [int]$Matches[1]
    Write-Host "Loaded CVE Mappings: $loadedCount" -ForegroundColor Green
    
    if ($loadedCount -eq $expectedCVEs.Count) {
        Write-Host "âœ… Database count CORRECT!" -ForegroundColor Green
    } else {
        Write-Host "âš ï¸ Database count mismatch!" -ForegroundColor Yellow
        Write-Host "   Expected: $($expectedCVEs.Count)" -ForegroundColor Yellow
        Write-Host "   Got:      $loadedCount" -ForegroundColor Yellow
    }
} else {
    Write-Host "âš ï¸ Could not detect database load message" -ForegroundColor Yellow
    Write-Host "Output preview:" -ForegroundColor Gray
    Write-Host ($output | Select-String "Loaded" | Out-String) -ForegroundColor Gray
}

Write-Host ""
Write-Host "ğŸ“‹ CVE EXPLOIT MAPPING TABLE" -ForegroundColor Yellow
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray

# Display expected exploits
$categories = @{
    "ğŸ”´ CRITICAL (2024)" = @("CVE-2024-3400")
    "ğŸŸ  HIGH (2023)" = @("CVE-2023-44487", "CVE-2023-20198", "CVE-2023-22515", "CVE-2023-34362", "CVE-2023-46604", "CVE-2023-4966", "CVE-2023-27350")
    "ğŸŸ¡ MEDIUM (2022)" = @("CVE-2022-41040", "CVE-2022-26134", "CVE-2022-22965")
    "ğŸŸ¢ KNOWN (2021)" = @("CVE-2021-44228", "CVE-2021-34473", "CVE-2021-26855")
    "ğŸ”µ CLASSIC (2020-2017)" = @("CVE-2020-1472", "CVE-2019-19781", "CVE-2019-0708", "CVE-2018-13379", "CVE-2018-7600", "CVE-2017-5638", "CVE-2017-0199", "CVE-2017-0144")
    "âš« LEGACY (2014-2008)" = @("CVE-2014-6271", "CVE-2012-1823", "CVE-2008-4250")
}

foreach ($category in $categories.Keys) {
    Write-Host "`n$category" -ForegroundColor Cyan
    foreach ($cve in $categories[$category]) {
        if ($expectedCVEs -contains $cve) {
            Write-Host "  âœ… $cve" -ForegroundColor Green
        } else {
            Write-Host "  âŒ $cve (MISSING!)" -ForegroundColor Red
        }
    }
}

Write-Host ""
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray
Write-Host "ğŸ“Š SUMMARY" -ForegroundColor Yellow
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray

$stats = @{
    "Total CVEs" = $expectedCVEs.Count
    "Critical (2024)" = 1
    "High (2023)" = 7
    "Medium (2022)" = 3
    "Known (2021)" = 3
    "Classic (2020-2017)" = 8
    "Legacy (2014-2008)" = 3
}

foreach ($key in $stats.Keys) {
    $value = $stats[$key]
    $padding = " " * (20 - $key.Length)
    Write-Host "${key}:${padding}${value}" -ForegroundColor White
}

Write-Host ""
Write-Host "ğŸ¯ EXPLOIT CATEGORIES" -ForegroundColor Yellow
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray

$exploitTypes = @{
    "Windows RCE" = @("CVE-2017-0144", "CVE-2008-4250", "CVE-2020-1472")
    "Exchange Server" = @("CVE-2022-41040", "CVE-2021-34473", "CVE-2021-26855")
    "Web Applications" = @("CVE-2021-44228", "CVE-2022-22965", "CVE-2017-5638", "CVE-2018-7600", "CVE-2014-6271", "CVE-2012-1823")
    "Network Devices" = @("CVE-2023-20198", "CVE-2024-3400", "CVE-2023-4966", "CVE-2019-19781", "CVE-2018-13379")
    "Confluence/Atlassian" = @("CVE-2023-22515", "CVE-2022-26134")
    "File Transfer" = @("CVE-2023-34362", "CVE-2023-27350")
    "Middleware" = @("CVE-2023-46604")
    "RDP/Remote Access" = @("CVE-2019-0708")
    "DoS/Auxiliary" = @("CVE-2023-44487")
    "Client-side" = @("CVE-2017-0199")
}

foreach ($type in $exploitTypes.Keys) {
    $count = $exploitTypes[$type].Count
    Write-Host "${type}: ${count} exploits" -ForegroundColor Cyan
}

Write-Host ""
Write-Host "ğŸ”’ SECURITY NOTES" -ForegroundColor Yellow
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray
Write-Host "âš ï¸  CRITICAL: These exploits are for AUTHORIZED testing ONLY!" -ForegroundColor Red
Write-Host "âš ï¸  Always use --msf-dry-run first to preview actions" -ForegroundColor Yellow
Write-Host "âš ï¸  Obtain written permission before exploitation" -ForegroundColor Yellow
Write-Host "âš ï¸  Understand legal implications in your jurisdiction" -ForegroundColor Yellow

Write-Host ""
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" -ForegroundColor DarkGray
if ($loadedCount -eq $expectedCVEs.Count) {
    Write-Host "âœ… DATABASE EXPANSION SUCCESSFUL!" -ForegroundColor Green
    Write-Host "   $loadedCount CVE â†’ MSF exploit mappings loaded" -ForegroundColor Green
} else {
    Write-Host "âš ï¸ DATABASE EXPANSION NEEDS VERIFICATION" -ForegroundColor Yellow
}
Write-Host "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`n" -ForegroundColor DarkGray
